using GameServer.Packets;
using RSLIB;
using RSLIB.Network;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace GameServer
{
    public class AvatarInfoPacketResponse : INetworkPacketAdapter
    {
        private byte[] packet;
        private Client client;
        private Server server;

        private void Run()
        {
            
            List<byte> avatarData = new List<byte>();

            byte.TryParse(this.client.info["job"].ToString(), out byte jobByte);

            byte[] first_job = Skill.GetSkillsBytesByJob(jobByte);

            byte[] second_job = Skill.GetSkillsBytesByJob(Job.GetTransformJob(jobByte), true);

            byte[] position_x = BitConverter.GetBytes((ushort)(((int)this.client.info["pos_x"] * 64) + 48));
            byte[] position_y = BitConverter.GetBytes((ushort)(((int)this.client.info["pos_y"] * 32) + 16));


            avatarData.AddRange(Convert.FromHexString("90 08 3D 12 00 00 00 00 1C 02 00 00 00 00 00 00 00 00 00 00 EC 13 00 00 B8 0B 00 00 FF FF 05 00 00 00 00 00 64 00 64 00 19 00 0F 00 14 00 0A 00 05 00 0F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 00 00 00 00 FF FF 00 00 00 00 FF FF 00 00 FF FF 00 00 FF FF 00 00 00 00 00 00 74 65 6D 70 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00".Replace(" ", "")));

            avatarData.AddRange(Helper.DefineLengthAndInsertString((string)client.info["avatar_name"], 18));
            avatarData.Add(jobByte);

            avatarData.AddRange(new byte[] { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 });

            avatarData.AddRange(position_x);
            avatarData.AddRange(new byte[] { 0x00, 0x00 });
            avatarData.AddRange(position_y);

            avatarData.AddRange(new byte[] { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 });

            avatarData.AddRange(first_job);
            avatarData.AddRange(second_job);
            avatarData.AddRange(new byte[] { 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF });
            avatarData.AddRange(new byte[] { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 });


            this.client.socket.Send(avatarData.ToArray());

        }

        public void SetParams(Client client, Server server, byte[] buffer)
        {
            this.client = client;
            this.server = server;
            this.packet = buffer;
            this.Run();
        }
    }
}


